#!/bin/bash -eu
#
# Debug a Radarr Custom Script event handler.
#
# Writes a shell script for each handled event that should reproduce the handling of the
# event.  Useful for debugging issues that are difficult to reproduce when not invoked
# as a Radarr custom script.


set -o pipefail
PS4='${LINENO}+'
# set -x


main() {
    servarr_name=Radarr

    servarr_type=radarr
    script_dir=$(dirname "$(realpath "${0}")")
    template_str=$(cat "${script_dir}/prunerr-debug-handle.in")
    debug_script=$(mktemp -p ~hotio/.local/bin/ "prunerr-debug-handle.${servarr_name}.XXXXXXXXXX")
    eval "echo \"${template_str}\"" >"${debug_script}"
    chmod -c ug+x "${debug_script}"

    export HOME=~hotio/
    exec prunerr handle "${servarr_name}" "${@}"
}


main "$@" 1>&2
